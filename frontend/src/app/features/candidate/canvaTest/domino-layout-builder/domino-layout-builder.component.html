<div class="layout-builder-container">
  <div class="toolbar">
    <div class="tool-section">
      <h3>Domino Layout Builder</h3>
      <div class="tool-group">
        <button class="tool-btn" (click)="clearCanvas()">Clear Canvas</button>
        <label>
          <input type="checkbox" [(ngModel)]="snapToGrid" /> Snap to Grid
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="showGrid" /> Show Grid
        </label>
      </div>
    </div>
    <div class="tool-section">
      <input type="text" [(ngModel)]="layoutName" placeholder="Layout Name" />
      <input
        type="text"
        [(ngModel)]="layoutDescription"
        placeholder="Description"
      />
      <select [(ngModel)]="layoutType">
        <option value="custom">Custom</option>
        <option value="spiral">Spiral</option>
        <option value="rhombus">Rhombus</option>
        <option value="grid">Grid</option>
      </select>
      <button class="save-btn" (click)="saveLayout()">Save Layout</button>
      <button class="export-btn" (click)="exportLayoutAsJson()">
        Export JSON
      </button>
    </div>
  </div>

  <div class="canvas-container">
    <div
      #canvas
      class="canvas"
      [style.width.px]="canvasWidth"
      [style.height.px]="canvasHeight"
      [class.show-grid]="showGrid"
    >
      <!-- Grid lines if showGrid is true -->
      <div class="grid-lines" *ngIf="showGrid">
        <div
          *ngFor="
            let x of [].constructor(canvasWidth / gridSize);
            let i = index
          "
          class="grid-line vertical"
          [style.left.px]="i * gridSize"
          [style.height.px]="canvasHeight"
        ></div>
        <div
          *ngFor="
            let y of [].constructor(canvasHeight / gridSize);
            let i = index
          "
          class="grid-line horizontal"
          [style.top.px]="i * gridSize"
          [style.width.px]="canvasWidth"
        ></div>
      </div>

      <!-- Dominos -->
      <div
        *ngFor="let domino of dominos"
        class="domino-wrapper"
        [class.selected]="selectedDomino?.id === domino.id"
        [style.transform]="getDominoTransform(domino)"
        (mousedown)="startDragging($event, domino)"
        (click)="selectDomino(domino)"
      >
        <app-interactive-domino
          [id]="domino.id"
          [width]="70 * getDominoScale(domino)"
          [height]="140 * getDominoScale(domino)"
          [initialTopValue]="domino.topValue"
          [initialBottomValue]="domino.bottomValue"
          [isEditable]="domino.isEditable"
        >
        </app-interactive-domino>
      </div>

      <!-- Canvas instructions when empty -->
      <div class="canvas-instructions" *ngIf="dominos.length === 0">
        <p>Click anywhere on the canvas to add a domino</p>
        <p>Drag dominos to position them</p>
      </div>
    </div>
  </div>

  <!-- Properties panel for selected domino -->
  <div class="properties-panel" [class.show]="showPropertyPanel">
    <h3>Domino Properties</h3>
    <div class="property-group" *ngIf="selectedDomino">
      <div class="property">
        <label>Position X:</label>
        <input type="number" [(ngModel)]="selectedDomino.exactX" step="1" />
      </div>
      <div class="property">
        <label>Position Y:</label>
        <input type="number" [(ngModel)]="selectedDomino.exactY" step="1" />
      </div>
      <div class="property">
        <label>Angle:</label>
        <input
          type="range"
          [(ngModel)]="selectedDomino.angle"
          min="0"
          max="360"
          step="5"
        />
        <span>{{ selectedDomino.angle }}Â°</span>
      </div>
      <div class="property">
        <label>Top Value:</label>
        <input
          type="number"
          [(ngModel)]="selectedDomino.topValue"
          min="0"
          max="6"
          step="1"
          [disabled]="selectedDomino.isEditable"
        />
      </div>
      <div class="property">
        <label>Bottom Value:</label>
        <input
          type="number"
          [(ngModel)]="selectedDomino.bottomValue"
          min="0"
          max="6"
          step="1"
          [disabled]="selectedDomino.isEditable"
        />
      </div>
      <div class="property">
        <label>Editable:</label>
        <input
          type="checkbox"
          [ngModel]="selectedDomino.isEditable"
          (ngModelChange)="
            selectedDomino!.isEditable = $event; toggleEditable()
          "
        />
      </div>
      <div class="property">
        <label>Scale:</label>
        <select [(ngModel)]="selectedDomino.scale">
          <option [ngValue]="0.5">Small (0.5x)</option>
          <option [ngValue]="0.75">Medium Small (0.75x)</option>
          <option [ngValue]="1.0" selected>Normal (1x)</option>
          <option [ngValue]="1.25">Medium Large (1.25x)</option>
          <option [ngValue]="1.5">Large (1.5x)</option>
        </select>
      </div>
      <div class="property-actions">
        <button class="delete-btn" (click)="deleteDomino()">
          Delete Domino
        </button>
        <button (click)="selectedDomino = null; showPropertyPanel = false">
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- Saved layouts panel -->
  <div class="saved-layouts-panel">
    <h3>Saved Layouts</h3>
    <div class="layouts-list">
      <div
        *ngFor="let layout of savedLayouts"
        class="layout-item"
        (click)="loadLayout(layout.id)"
      >
        <div class="layout-name">{{ layout.name }}</div>
        <div class="layout-type">{{ layout.type }}</div>
        <div class="layout-count">{{ layout.dominos.length }} dominos</div>
      </div>
    </div>
  </div>
</div>
