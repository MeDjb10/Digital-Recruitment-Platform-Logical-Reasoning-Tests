<div class="container mx-auto py-8 px-4">
  <p-toast position="top-right"></p-toast>

  <!-- Header Section -->
  <div class="text-center mb-8">
    <span
      class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold mb-2 animate-bounce"
    >
      <i class="pi pi-file-edit mr-1"></i>{{ 'APPLICATION_FORM.DEMANDE_AUTORISATION' | translate }}
    </span>
    <h1 class="text-3xl font-bold text-blue-800 mb-2">{{ 'APPLICATION_FORM.FORMULAIRE_INSCRIPTION' | translate }}</h1>
    <p class="text-gray-600">
      {{ 'APPLICATION_FORM.COMPLETER_PROFIL' | translate }}
    </p>
    <div class="relative mx-auto">
      <div class="h-1 w-24 bg-red-500 rounded-full mx-auto mt-4 shadow-sm"></div>
      <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-8 h-2 bg-red-400 rounded-full opacity-40 blur-sm"></div>
    </div>
  </div>

  <!-- Form Stepper -->
  <div class="card flex justify-center">
    <p-stepper [value]="1" class="w-full max-w-4xl">
      <p-step-list>
        <p-step [value]="1">{{ 'APPLICATION_FORM.PHOTO' | translate }}</p-step>
        <p-step [value]="2">{{ 'APPLICATION_FORM.INFORMATION_PERSONNELLE' | translate }}</p-step>
        <p-step [value]="3">{{ 'APPLICATION_FORM.INFORMATION_PROFESSIONNELLE' | translate }}</p-step>
        <p-step [value]="4">{{ 'APPLICATION_FORM.INFORMATIONS_ENTREPRISE' | translate }}</p-step>
        <p-step [value]="5">{{ 'APPLICATION_FORM.CONFIRMATION' | translate }}</p-step>
      </p-step-list>

      <!-- Step content panels -->
      <p-step-panels>
        <!-- Step 1: Profile Picture -->
        <p-step-panel [value]="1">
          <ng-template #content let-activateCallback="activateCallback">
            <p-card styleClass="shadow-lg">
              <div class="text-center mb-5">
                <h2 class="text-2xl font-bold text-blue-800">
                  {{ 'APPLICATION_FORM.PHOTO' | translate }}
                </h2>
                <p class="text-gray-600 mt-2">
                  {{ 'APPLICATION_FORM.TELECHARGEMENT_PHOTO' | translate }}
                </p>
                <div
                  class="w-32 h-1 bg-blue-500 mx-auto mt-3 rounded-full"
                ></div>
              </div>

              <!-- Enhanced Profile Picture Preview with Upload Options -->
              <div class="profile-section">
                <!-- Left side: Preview -->
                <div class="profile-preview-container">
                  <div
                    class="profile-preview"
                    tabindex="0"
                    aria-label="Profile picture preview"
                  >
                    <ng-container
                      *ngIf="profilePicturePreview; else placeholderTemplate"
                    >
                      <img
                        [src]="profilePicturePreview"
                        alt="Profile Preview"
                        class="w-full h-full object-cover"
                      />
                    </ng-container>
                    <ng-template #placeholderTemplate>
                      <div class="profile-placeholder">
                        <i class="pi pi-user"></i>
                      </div>
                    </ng-template>
                  </div>

                  <!-- File information badge -->
                  <div
                    *ngIf="profilePictureFile"
                    class="file-info-badge"
                    role="status"
                  >
                    <i class="pi pi-check-circle"></i>
                    <span
                      >{{ profilePictureFile.name }} ({{
                        formatSize(profilePictureFile.size)
                      }})</span
                    >
                  </div>
                </div>

                <!-- Right side: Upload options -->
                <div class="upload-options">

                  <h3 class="upload-options-title">{{ 'APPLICATION_FORM.OPTION' | translate }}</h3>


                  <!-- Hidden FileUpload component -->
                  <p-fileUpload
                    #fileUpload
                    [showUploadButton]="false"
                    [showCancelButton]="false"
                    [maxFileSize]="1000000"
                    accept="image/*"
                    [multiple]="false"
                    chooseLabel="Select Image"
                    styleClass="hidden-upload"
                    (onSelect)="onProfilePictureSelect($event)"
                    (onError)="onFileUploadError($event)"
                  ></p-fileUpload>

                  <!-- Custom button that triggers the file upload -->
                  <button
                    type="button"
                    class="select-image-btn"
                    (click)="triggerFileInput()"
                  >
                    <i class="pi pi-image mr-2"></i>
                    {{ 'APPLICATION_FORM.CHOIX_PHOTO' | translate }}
                  </button>

                  <p class="upload-divider"><span>or</span></p>

                  <!-- Enhanced drag area -->
                  <div
                    class="enhanced-drop-zone"
                    [class.active-zone]="isDragOver"
                    (dragover)="onDragOver($event)"
                    (dragleave)="onDragLeave($event)"
                    (drop)="onDrop($event)"
                    (click)="triggerFileInput()"
                    tabindex="0"
                    role="button"
                    aria-label="Drag and drop area for image upload"
                    (keydown.enter)="triggerFileInput()"
                  >
                    <i class="pi pi-cloud-upload"></i>
                    <p>{{ 'APPLICATION_FORM.DEPOT_IMAGE' | translate }}</p>
                  </div>

                  <!-- Remove button for when an image is selected -->
                  <button
                    *ngIf="profilePictureFile"
                    type="button"
                    class="remove-image-btn"
                    (click)="removeProfilePicture()"
                  >
                    <i class="pi pi-trash mr-2"></i>
                    Remove Photo
                  </button>
                </div>
              </div>

              <!-- Progress indicator -->
              <div
                *ngIf="uploadProgress > 0 && uploadProgress < 100"
                class="upload-progress"
              >
                <p-progressBar
                  [value]="uploadProgress"
                  [showValue]="true"
                  styleClass="mt-3"
                  aria-label="Upload progress"
                ></p-progressBar>
              </div>

              <!-- Enhanced Guidelines Card -->
              <div
                class="guidelines-card"
                role="region"
                aria-label="Profile picture guidelines"
              >
                <div class="guidelines-title">
                  <i class="pi pi-info-circle"></i>
                  <h3>{{ 'APPLICATION_FORM.CONSIGNES_PHOTO' | translate }}</h3>
                </div>
                <ul class="guidelines-list text-gray-600">
                  <li>{{ 'APPLICATION_FORM.PHOTO_GUIDELINES.ARRIERE_PLAN' | translate }}</li>
                  <li>{{ 'APPLICATION_FORM.PHOTO_GUIDELINES.VISAGE_VISIBLE' | translate }}</li>
                  <li>{{ 'APPLICATION_FORM.PHOTO_GUIDELINES.TAILLE' | translate }}</li>
                </ul>
              </div>

              <!-- Navigation -->
              <div class="flex pt-4 justify-end">
                <p-button
                  label="{{ 'APPLICATION_FORM.SUIVANT' | translate }}"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  (onClick)="activateCallback(2)"
                  styleClass="p-button-raised"
                ></p-button>
              </div>
            </p-card>
          </ng-template>
        </p-step-panel>

        <!-- Step 2: Personal Information -->
        <p-step-panel [value]="2">
          <ng-template #content let-activateCallback="activateCallback">
            <p-card styleClass="shadow-lg">
              <form [formGroup]="personalInfoForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <!-- First Name -->
                  <div class="field">
                    <label
                      for="firstName"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PERSONAL_INFO.FIRST_NAME' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <div class="p-inputgroup w-full">
                      <span class="p-inputgroup-addon">
                        <i class="pi pi-user"></i>
                      </span>
                      <input
                        pInputText
                        id="firstName"
                        formControlName="firstName"
                        class="w-full"
                        [placeholder]="'APPLICATION_FORM.PERSONAL_INFO.FIRST_NAME' | translate"
                      />
                    </div>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(personalInfoForm, 'firstName')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>

                  <!-- Last Name -->
                  <div class="field">
                    <label
                      for="lastName"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PERSONAL_INFO.LAST_NAME' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <div class="p-inputgroup w-full">
                      <span class="p-inputgroup-addon">
                        <i class="pi pi-user"></i>
                      </span>
                      <input
                        pInputText
                        id="lastName"
                        formControlName="lastName"
                        class="w-full"
                        [placeholder]="'APPLICATION_FORM.PERSONAL_INFO.LAST_NAME' | translate"
                      />
                    </div>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(personalInfoForm, 'lastName')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>

                  <!-- Email -->
                  <div class="field">
                    <label
                      for="email"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PERSONAL_INFO.EMAIL' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <div class="p-inputgroup w-full">
                      <span class="p-inputgroup-addon">
                        <i class="pi pi-envelope"></i>
                      </span>
                      <input
                        pInputText
                        id="email"
                        formControlName="email"
                        class="w-full"
                        [placeholder]="'APPLICATION_FORM.PERSONAL_INFO.EMAIL' | translate"
                      />
                    </div>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(personalInfoForm, 'email')"
                    >
                      {{ 'ERRORS.INVALID_EMAIL' | translate }}
                    </small>
                  </div>

                  <!-- Gender -->
                  <div class="field">
                    <label
                      for="gender"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PERSONAL_INFO.GENDER' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <p-select
                      id="gender"
                      formControlName="gender"
                      [options]="genderOptions"
                      optionLabel="label"
                      optionValue="value"
                      [placeholder]="'APPLICATION_FORM.PERSONAL_INFO.GENDER' | translate"
                      [showClear]="true"
                      styleClass="w-full"
                    ></p-select>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(personalInfoForm, 'gender')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>
                  <!-- Date of Birth -->
                  <div class="field col-span-2">
                    <label
                      for="dateOfBirth"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PERSONAL_INFO.DATE_OF_BIRTH' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <p-datePicker
                      id="dateOfBirth"
                      formControlName="dateOfBirth"
                      [showIcon]="true"
                      [maxDate]="maxDate"
                      [minDate]="minDate"
                      dateFormat="dd/mm/yy"
                      styleClass="w-full"
                      [showButtonBar]="true"

                      [placeholder]="'APPLICATION_FORM.PERSONAL_INFO.DATE_OF_BIRTH' | translate"

                    ></p-datePicker>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(personalInfoForm, 'dateOfBirth')"
                    >

                      <span
                        *ngIf="personalInfoForm.get('dateOfBirth')?.errors?.['required']"
                      >
                        {{ 'ERRORS.REQUIRED' | translate }}
                      </span>
                      <span
                        *ngIf="personalInfoForm.get('dateOfBirth')?.errors?.['minAge']"
                      >
                        You must be at least 18 years old to apply
                      </span>

                    </small>
                  </div>
                </div>
              </form>
              <div class="bg-blue-50 p-4 rounded-lg mt-4 flex items-start border-l-4 border-blue-500 shadow-sm">
                <i class="pi pi-info-circle text-blue-500 mr-3 text-xl"></i>
                <div>
                  <h4 class="text-blue-700 font-medium mb-1 text-sm">
                    {{ 'APPLICATION_FORM.PERSONAL_INFO.WHY_WE_ASK' | translate }}
                  </h4>
                  <p class="text-sm text-gray-600">
                    {{ 'APPLICATION_FORM.PERSONAL_INFO.INFO_HELP' | translate }}
                  </p>
                </div>
              </div>
              <!-- Navigation -->
              <div class="flex pt-4 justify-between">
                <p-button
                  [label]="'BUTTONS.BACK' | translate"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(1)"
                  styleClass="p-button-outlined"
                ></p-button>

                <p-button
                  [label]="'BUTTONS.NEXT' | translate"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  [disabled]="personalInfoForm.invalid"
                  (onClick)="activateCallback(3)"
                  styleClass="p-button-raised"
                ></p-button>
              </div>
            </p-card>
          </ng-template>
        </p-step-panel>

        <!-- Step 3: Professional Information -->
        <p-step-panel [value]="3">
          <ng-template #content let-activateCallback="activateCallback">
            <p-card styleClass="shadow-lg">
              <form [formGroup]="jobInfoForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <!-- Current Position -->
                  <div class="field">
                    <label
                      for="currentPosition"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PROFESSIONAL_INFO.CURRENT_POSITION' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <div class="p-inputgroup w-full">
                      <span class="p-inputgroup-addon">
                        <i class="pi pi-briefcase"></i>
                      </span>
                      <input
                        pInputText
                        id="currentPosition"
                        formControlName="currentPosition"
                        placeholder="Your current job title (e.g., Software Developer, Manager, Student)"
                        class="w-full"
                        [placeholder]="'APPLICATION_FORM.PROFESSIONAL_INFO.CURRENT_POSITION' | translate"
                      />
                    </div>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(jobInfoForm, 'currentPosition')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>

                  <!-- Desired Position -->
                  <div class="field">
                    <label
                      for="desiredPosition"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PROFESSIONAL_INFO.DESIRED_POSITION' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <div class="p-inputgroup w-full">
                      <span class="p-inputgroup-addon">
                        <i class="pi pi-star"></i>
                      </span>
                      <input
                        pInputText
                        id="desiredPosition"
                        formControlName="desiredPosition"
                        placeholder="The position you dream of or want to achieve"
                        class="w-full"
                        [placeholder]="'APPLICATION_FORM.PROFESSIONAL_INFO.DESIRED_POSITION' | translate"
                      />
                    </div>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(jobInfoForm, 'desiredPosition')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>

                  <!-- Education Level -->
                  <div class="field">
                    <label
                      for="educationLevel"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PROFESSIONAL_INFO.EDUCATION_LEVEL' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <p-select
                      id="educationLevel"
                      formControlName="educationLevel"
                      [options]="educationOptions"
                      optionLabel="label"
                      optionValue="value"
                      [placeholder]="'APPLICATION_FORM.PROFESSIONAL_INFO.EDUCATION_LEVEL' | translate"
                      [showClear]="true"
                      styleClass="w-full"
                    ></p-select>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(jobInfoForm, 'educationLevel')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>

                  <!-- Availability -->
                  <div class="field">
                    <label
                      for="availability"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.PROFESSIONAL_INFO.AVAILABILITY' | translate }} <span class="text-red-500">*</span>
                    </label>
                    <p-select
                      id="availability"
                      formControlName="availability"
                      [options]="availabilityOptions"
                      optionLabel="label"
                      optionValue="value"
                      [placeholder]="'APPLICATION_FORM.PROFESSIONAL_INFO.AVAILABILITY' | translate"
                      styleClass="w-full"
                    ></p-select>
                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(jobInfoForm, 'availability')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>
                </div>
              </form>

              <div class="bg-blue-50 p-4 rounded-lg mt-4 flex items-start border-l-4 border-blue-500 shadow-sm">
                <i class="pi pi-info-circle text-blue-500 mr-3 text-xl"></i>
                <div>
                  <h4 class="text-blue-700 font-medium mb-1 text-sm">
                    {{ 'APPLICATION_FORM.PROFESSIONAL_INFO.TITLE' | translate }}
                  </h4>
                  <p class="text-sm text-gray-600">
                    {{ 'APPLICATION_FORM.PROFESSIONAL_INFO.INFO_HELP' | translate }}
                  </p>
                </div>
              </div>

              <!-- Navigation -->
              <div class="flex pt-4 justify-between">
                <p-button
                  [label]="'BUTTONS.BACK' | translate"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(2)"
                  styleClass="p-button-outlined"
                ></p-button>

                <p-button
                  [label]="'BUTTONS.NEXT' | translate"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  [disabled]="jobInfoForm.invalid"
                  (onClick)="activateCallback(4)"
                  styleClass="p-button-raised"
                ></p-button>
              </div>
            </p-card>
          </ng-template>
        </p-step-panel>

        <!-- Step 4: Company Information -->
        <p-step-panel [value]="4">
          <ng-template #content let-activateCallback="activateCallback">
            <p-card styleClass="shadow-lg">
              <div class="text-center mb-4">
                <h2 class="text-xl font-semibold text-blue-800">
                  {{ 'APPLICATION_FORM.INFORMATIONS_ENTREPRISE' | translate }}
                </h2>
                <p class="text-gray-600">
                  {{ 'APPLICATION_FORM.INFORMATIONS_ENTREPRISE_AIDENT' | translate }}
                </p>
              </div>

              <form [formGroup]="companyInfoForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <!-- Job Position -->
                  <div class="field">
                    <label
                      for="jobPosition"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.POSTE' | translate }} <span class="text-red-500">*</span>
                    </label>

                    <p-select
                      id="jobPosition"
                      formControlName="jobPosition"
                      [options]="jobPositionOptions"
                      optionLabel="label"
                      optionValue="value"
                      [placeholder]="'APPLICATION_FORM.POSTE' | translate"
                      [showClear]="true"
                      styleClass="w-full"
                    ></p-select>

                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(companyInfoForm, 'jobPosition')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>

                  <!-- Company -->
                  <div class="field">
                    <label
                      for="company"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.ENTREPRISE' | translate }} <span class="text-red-500">*</span>
                    </label>

                    <p-select
                      id="company"
                      formControlName="company"
                      [options]="companyOptions"
                      optionLabel="label"
                      optionValue="value"
                       [placeholder]="'APPLICATION_FORM.ENTREPRISE' | translate"
                      [showClear]="true"
                      styleClass="w-full"
                    ></p-select>

                    <small
                      class="text-red-500"
                      *ngIf="isFieldInvalid(companyInfoForm, 'company')"
                    >
                      {{ 'ERRORS.REQUIRED' | translate }}
                    </small>
                  </div>

                  <!-- Department -->
                  <div class="field">
                    <label
                      for="department"
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      {{ 'APPLICATION_FORM.DEPARTEMENT' | translate }}
                    </label>

                    <p-select
                      id="department"
                      formControlName="department"
                      [options]="departmentOptions"
                      optionLabel="label"
                      optionValue="value"
                      [placeholder]="'APPLICATION_FORM.DEPARTEMENT_DESC' | translate"
                      [showClear]="true"
                      styleClass="w-full"
                    ></p-select>

                  </div>

                  <!-- Additional Info -->
                  <!-- Replace the Additional Info field with this enhanced version -->
                  <div class="field col-span-2">
                    <!-- Header with label and optional badge side by side -->
                    <div class="textarea-header">
                      <label for="additionalInfo" class="enhanced-label">
                        <i class="pi pi-align-left text-blue-600 mr-2"></i>
                        {{ 'APPLICATION_FORM.ADDITONAL_INFO' | translate }}
                      </label>
                      <span class="textarea-badge">
                        <i class="pi pi-info-circle mr-1"></i>
                        {{ 'APPLICATION_FORM.OPTIONAL' | translate }}
                      </span>
                    </div>

                    <!-- Textarea with floating icon -->
                    <div class="textarea-wrapper">
                      <textarea
                        pInputTextarea
                        id="additionalInfo"
                        formControlName="additionalInfo"
                        class="enhanced-textarea"
                        rows="5"
                        [placeholder]="'APPLICATION_FORM.ADDITIONAL_INFO_DESC' | translate"
                      ></textarea>
                      <div class="textarea-icon">
                        <i class="pi pi-pencil"></i>
                      </div>
                    </div>

                    <!-- Footer with character counter and hint text side by side -->
                    <div class="textarea-footer">
                      <small class="textarea-hint">
                        <i class="pi pi-lightbulb text-yellow-500 mr-2"></i>
                        <span>{{ 'APPLICATION_FORM.INCLURE_QUALIFICATION' | translate }}</span>
                      </small>

                      <span
                        class="textarea-counter"
                        *ngIf="companyInfoForm.get('additionalInfo')?.value"
                      >
                        {{
                          companyInfoForm.get("additionalInfo")?.value.length
                        }}
                        characters
                      </span>
                    </div>
                  </div>
                </div>
              </form>

              <div
                class="bg-blue-50 p-4 rounded-lg mt-4 flex items-start border-l-4 border-blue-500 shadow-sm"
              >
                <i class="pi pi-info-circle text-blue-500 mr-3 text-xl"></i>
                <div>
                  <h4 class="text-blue-700 font-medium mb-1 text-sm">
                    {{ 'APPLICATION_FORM.COMPANY_INFO.WHY_WE_ASK' | translate }}
                  </h4>
                  <p class="text-sm text-gray-600">
                    {{ 'APPLICATION_FORM.COMPANY_INFO.INFO_HELP' | translate }}
                  </p>
                </div>
              </div>

              <!-- Navigation -->
              <div class="flex pt-4 justify-between">
                <p-button
                  [label]="'BUTTONS.BACK' | translate"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(3)"
                  styleClass="p-button-outlined"
                ></p-button>

                <p-button
                  [label]="'BUTTONS.NEXT' | translate"
                  icon="pi pi-arrow-right"
                  iconPos="right"
                  [disabled]="companyInfoForm.invalid"
                  (onClick)="activateCallback(5)"
                  styleClass="p-button-raised"
                ></p-button>
              </div>
            </p-card>
          </ng-template>
        </p-step-panel>

        <!-- Step 5: Confirmation -->
        <p-step-panel [value]="5">
          <ng-template #content let-activateCallback="activateCallback">
            <p-card styleClass="shadow-lg">
              <div class="mb-2">
                <h2 class="text-2xl font-bold text-blue-800 mb-4 text-center">
                  {{ 'APPLICATION_FORM.SUMMARY.TITLE' | translate }}
                </h2>
                <p class="text-gray-600 mb-6 text-center">
                  {{ 'APPLICATION_FORM.SUMMARY.REVIEW_INFO' | translate }}
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <!-- Profile Picture Summary -->
                  <div class="border rounded-lg p-4 bg-blue-50 flex flex-col items-center">
                    <h3 class="text-lg font-semibold mb-3 text-blue-700">
                      <i class="pi pi-camera mr-2"></i>{{ 'APPLICATION_FORM.SUMMARY.PROFILE_PICTURE' | translate }}
                    </h3>
                    <p-divider></p-divider>

                    <!-- Profile picture preview section -->
                    <div
                      class="w-32 h-32 rounded-full border-2 border-blue-200 overflow-hidden mb-3 bg-gray-100 flex items-center justify-center"
                    >
                      <img
                        *ngIf="profilePicturePreview"
                        [src]="profilePicturePreview"
                        alt="Profile Preview"
                        class="w-full h-full object-cover"
                      />
                      <i
                        *ngIf="!profilePicturePreview"
                        class="pi pi-user text-5xl text-gray-300"
                      ></i>
                    </div>

                    <p
                      *ngIf="profilePictureFile"
                      class="text-sm text-gray-600 text-center"
                    >
                      {{ profilePictureFile.name }}<br />
                      {{ formatSize(profilePictureFile.size) }}
                    </p>
                    <p *ngIf="!profilePictureFile" class="text-sm text-gray-600 text-center">
                      {{ 'APPLICATION_FORM.SUMMARY.NO_PICTURE' | translate }}
                    </p>
                  </div>

                  <!-- Personal Information Summary -->
                  <div class="border rounded-lg p-4 bg-blue-50">
                    <h3 class="text-lg font-semibold mb-3 text-blue-700">
                      <i class="pi pi-user mr-2"></i>{{ 'APPLICATION_FORM.SUMMARY.PERSONAL_INFO' | translate }}
                    </h3>
                    <p-divider></p-divider>

                    <div class="grid grid-cols-1 gap-2">
                      <div class="flex justify-between">
                        <span class="font-medium">{{ 'APPLICATION_FORM.SUMMARY.NAME' | translate }}:</span>
                        <span>{{ personalInfoForm.get("firstName")?.value }} {{ personalInfoForm.get("lastName")?.value }}</span>
                      </div>

                      <div class="flex justify-between">
                        <span class="font-medium">{{ 'APPLICATION_FORM.SUMMARY.EMAIL' | translate }}:</span>
                        <span>{{ personalInfoForm.get("email")?.value }}</span>
                      </div>

                      <div class="flex justify-between">
                        <span class="font-medium">{{ 'APPLICATION_FORM.SUMMARY.GENDER' | translate }}:</span>
                        <span>{{ genderLabel }}</span>
                      </div>

                      <div class="flex justify-between">
                        <span class="font-medium">{{ 'APPLICATION_FORM.SUMMARY.DATE_OF_BIRTH' | translate }}:</span>
                        <span>{{ personalInfoForm.get("dateOfBirth")?.value | date : "dd/MM/yyyy" }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- Professional Information Summary -->
                  <div class="border rounded-lg p-4 bg-blue-50">
                    <h3 class="text-lg font-semibold mb-3 text-blue-700">
                      <i class="pi pi-briefcase mr-2"></i>{{ 'APPLICATION_FORM.SUMMARY.PROFESSIONAL_INFO' | translate }}
                    </h3>
                    <p-divider></p-divider>

                    <div class="grid grid-cols-2 gap-y-2">
                      <div class="font-semibold">{{ 'APPLICATION_FORM.SUMMARY.CURRENT_POSITION' | translate }}:</div>
                      <div>{{ jobInfoForm.get("currentPosition")?.value }}</div>

                      <div class="font-semibold">{{ 'APPLICATION_FORM.SUMMARY.DESIRED_POSITION' | translate }}:</div>
                      <div>{{ jobInfoForm.get("desiredPosition")?.value }}</div>

                      <div class="font-semibold">{{ 'APPLICATION_FORM.SUMMARY.EDUCATION_LEVEL' | translate }}:</div>
                      <div>{{ educationLabel }}</div>

                      <div class="font-semibold">{{ 'APPLICATION_FORM.SUMMARY.AVAILABILITY' | translate }}:</div>
                      <div>{{ availabilityLabel }}</div>
                    </div>
                  </div>

                  <!-- Company Information Summary -->
                  <div class="border rounded-lg p-4 bg-blue-50">
                    <h3 class="text-lg font-semibold mb-3 text-blue-700">
                      <i class="pi pi-building mr-2"></i>{{ 'APPLICATION_FORM.SUMMARY.COMPANY_INFO' | translate }}
                    </h3>
                    <p-divider></p-divider>
                    <div class="grid grid-cols-1 gap-2">
                      <div class="flex justify-between">

                        <span class="font-medium">{{ 'APPLICATION_FORM.SUMMARY.JOB_POSITION' | translate }}:</span>
                        <span>{{ jobPositionLabel }}</span>
                      </div>

                      <div class="flex justify-between">
                        <span class="font-medium">{{ 'APPLICATION_FORM.SUMMARY.COMPANY' | translate }}:</span>
                        <span>{{ companyLabel }}</span>
                      </div>

                      <div class="flex justify-between">
                        <span class="font-medium">{{ 'APPLICATION_FORM.SUMMARY.DEPARTMENT' | translate }}:</span>
                        <span>{{ departmentLabel || "Not specified" }}</span>

                      </div>
                    </div>

                    <div *ngIf="companyInfoForm.get('additionalInfo')?.value" class="mt-2">
                      <span class="font-medium">{{ 'APPLICATION_FORM.SUMMARY.ADDITIONAL_INFO' | translate }}:</span>
                      <p class="text-sm mt-1 text-gray-600">
                        {{ companyInfoForm.get("additionalInfo")?.value }}
                      </p>
                    </div>
                  </div>
                </div>

                <!-- Terms and Privacy -->
                <div class="text-center mt-6 border-t pt-4 border-gray-200">
                  <p class="text-sm text-gray-500 mb-4">
                    {{ 'APPLICATION_FORM.TERMS.AGREE_TEXT' | translate }}
                    <a href="#" class="text-blue-600 hover:underline">{{ 'APPLICATION_FORM.TERMS.TERMS_SERVICE' | translate }}</a>
                    {{ 'APPLICATION_FORM.TERMS.AND' | translate }}
                    <a href="#" class="text-blue-600 hover:underline">{{ 'APPLICATION_FORM.TERMS.PRIVACY_POLICY' | translate }}</a>
                  </p>

                  <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 text-center max-w-lg mx-auto">
                    <i class="pi pi-info-circle text-blue-500 text-xl mb-2"></i>
                    <p class="text-sm text-gray-700">
                      {{ 'APPLICATION_FORM.TERMS.REVIEW_NOTE' | translate }}
                    </p>
                  </div>
                </div>
              </div>

              <!-- Navigation -->
              <div class="flex pt-4 justify-between">
                <p-button
                  [label]="'BUTTONS.BACK' | translate"
                  icon="pi pi-arrow-left"
                  (onClick)="activateCallback(4)"
                  styleClass="p-button-outlined"
                ></p-button>

                <p-button
                  [label]="'APPLICATION_FORM.BUTTONS.SUBMIT_APPLICATION' | translate"
                  icon="pi pi-check"
                  iconPos="right"
                  [disabled]="submitting"
                  [loading]="submitting"
                  (onClick)="onSubmit()"
                  class="submit-pulse"
                  styleClass="p-button-success"
                ></p-button>
              </div>
            </p-card>
          </ng-template>
        </p-step-panel>
      </p-step-panels>
    </p-stepper>
  </div>
</div>
