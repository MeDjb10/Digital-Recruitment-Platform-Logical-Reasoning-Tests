<div class="p-4 space-y-6">
  <!-- Request Step -->
  <div *ngIf="step === 'request'" class="text-center">
    <p class="mb-4">We'll send a verification code to your email to change your password</p>
    <button pButton label="Send Verification Code" 
            [disabled]="isProcessing"
            (click)="requestPasswordReset()"
            class="w-full">
      <i class="pi pi-spin pi-spinner" *ngIf="isProcessing"></i>
      <span>{{ isProcessing ? 'Sending...' : '' }}</span>
    </button>
  </div>

  <!-- Verify OTP Step -->
  <div *ngIf="step === 'verify'" class="space-y-4">
    <div class="form-group">
      <label for="otp" class="block text-sm font-medium text-gray-700 mb-1">Enter Verification Code</label>
      <input type="text" id="otp" pInputText [(ngModel)]="otp" class="w-full" placeholder="Enter verification code">
    </div>
    <button pButton label="Verify Code" 
            [disabled]="!otp || isProcessing"
            (click)="verifyOTP()"
            class="w-full">
      <i class="pi pi-spin pi-spinner" *ngIf="isProcessing"></i>
      <span>{{ isProcessing ? 'Verifying...' : '' }}</span>
    </button>
  </div>

  <!-- Reset Password Step -->
  <div *ngIf="step === 'reset'" class="space-y-4">
    <!-- New Password -->
    <div class="form-group">
      <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
      <div class="p-input-icon-right w-full">
        <i class="pi" [ngClass]="hideNewPassword ? 'pi-eye' : 'pi-eye-slash'" 
           (click)="hideNewPassword = !hideNewPassword"
           style="cursor: pointer;"></i>
        <input [type]="hideNewPassword ? 'password' : 'text'"
               id="newPassword" 
               pInputText
               [(ngModel)]="passwordData.newPassword"
               class="w-full"
               placeholder="Enter new password"
               (ngModelChange)="calculatePasswordStrength($event)">
      </div>
      <!-- Password Strength Indicator -->
      <div class="mt-2">
        <div class="flex space-x-1 mb-1">
          <div *ngFor="let level of [1, 2, 3, 4]" class="h-1.5 w-1/4 rounded-full transition-colors duration-300"
            [ngClass]="{
                     'bg-red-500': passwordStrength >= 1 && level === 1,
                     'bg-orange-500': passwordStrength >= 2 && level === 2,
                     'bg-yellow-500': passwordStrength >= 3 && level === 3,
                     'bg-green-600': passwordStrength >= 4 && level === 4,
                     'bg-gray-300': passwordStrength < level
                   }">
          </div>
        </div>
        <p class="text-xs" [ngClass]="{
              'text-red-500': passwordStrength === 1,
              'text-orange-500': passwordStrength === 2,
              'text-yellow-500': passwordStrength === 3,
              'text-green-600': passwordStrength === 4,
              'text-gray-500': passwordStrength === 0
            }">
          {{ passwordStrengthText }}
        </p>
      </div>
    </div>

    <!-- Confirm Password -->
    <div class="form-group">
      <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
      <div class="p-input-icon-right w-full">
        <i class="pi" [ngClass]="hideConfirmPassword ? 'pi-eye' : 'pi-eye-slash'"
           (click)="hideConfirmPassword = !hideConfirmPassword"
           style="cursor: pointer;"></i>
        <input [type]="hideConfirmPassword ? 'password' : 'text'"
               id="confirmPassword"
               pInputText
               [(ngModel)]="passwordData.confirmPassword"
               class="w-full"
               placeholder="Confirm new password">
      </div>
    </div>
  </div>
</div>

<div class="flex justify-end gap-3 pt-4 border-t">
  <button pButton label="Cancel" class="p-button-outlined" (click)="hideDialog()"></button>
  <button *ngIf="step === 'reset'"
          pButton 
          label="Change Password"
          [disabled]="!isPasswordValid() || isProcessing"
          (click)="changePassword()">
    <i class="pi pi-spin pi-spinner" *ngIf="isProcessing"></i>
    <span>{{ isProcessing ? 'Changing...' : 'Change Password' }}</span>
  </button>
</div>