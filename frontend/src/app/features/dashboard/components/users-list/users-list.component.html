<div class="bg-white p-6 rounded-xl shadow-lg">
    <p-toast></p-toast>
    
    <!-- Header Section -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
        <div class="flex-1">
            <h2 class="text-2xl font-bold text-blue-700 mb-1">Liste des utilisateurs</h2>
            <p class="text-gray-600 text-sm">{{filteredUsers.length}} utilisateurs au total</p>
        </div>

        <!-- Search and Add User -->
        <div class="flex gap-3 w-full sm:w-auto">
            <span class="p-input-icon-left flex-1 sm:w-80">
                <i class="pi pi-search"></i>
                <input type="text" pInputText 
                       class="w-full p-3 border-2 border-gray-200 rounded-lg"
                       placeholder="Rechercher..."
                       (input)="onSearchChange($event)" />
            </span>
            <button pButton 
                    icon="pi pi-plus" 
                    label="Nouveau" 
                    class="p-button-primary"></button>
        </div>
    </div>

    <!-- Loading Skeleton -->
    <div *ngIf="loading" class="animate-pulse">
        <div class="h-12 bg-gray-200 rounded mb-4"></div>
        <div class="space-y-3">
            <div class="h-20 bg-gray-200 rounded" *ngFor="let i of [1,2,3,4]"></div>
        </div>
    </div>

    <!-- Table -->
    <p-table [value]="filteredUsers" 
             [paginator]="true" 
             [rows]="10"
             [showCurrentPageReport]="true"
             [tableStyle]="{ 'min-width': '50rem' }"
             styleClass="p-datatable-striped p-datatable-gridlines p-datatable-sm"
             [rowHover]="true"
             responsiveLayout="stack"
             [loading]="loading">
        <ng-template pTemplate="header">
            <tr class="bg-gray-50">
                <th pSortableColumn="firstName" class="p-4">
                    <div class="flex items-center gap-2">
                        Nom <p-sortIcon field="nom"></p-sortIcon>
                    </div>
                </th>
                <th pSortableColumn="email" class="p-4">
                    <div class="flex items-center gap-2">
                        Email <p-sortIcon field="email"></p-sortIcon>
                    </div>
                </th>
                <th class="p-4">Role</th>
                <th class="p-4 text-right">Actions</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-user>
            <tr class="hover:bg-blue-50/50 transition-colors">
                <td class="p-4">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                            <span class="text-blue-600 font-medium">{{user.firstName?.charAt(0) || ''}}</span>
                        </div>
                        <div>
                            <p class="font-medium">{{ user.firstName }} {{ user.lastName }}</p>
                            <p class="text-sm text-gray-500">Inscrit le: {{user.createdAt | date:'shortDate'}}</p>
                        </div>
                    </div>
                </td>
                <td class="p-4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-envelope text-gray-400"></i>
                        {{ user.email }}
                    </div>
                </td>
                <td class="p-4">
                    <div [ngSwitch]="user.role">
                        <span *ngSwitchCase="'admin'"
                            class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700">
                            <i class="pi pi-shield"></i> Admin
                        </span>
                        <span *ngSwitchCase="'psychologue'"
                            class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">
                            <i class="pi pi-heart"></i> Psychologue
                        </span>
                        <span *ngSwitchCase="'candidate'"
                            class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
                            <i class="pi pi-user"></i> Candidat
                        </span>
                        <span *ngSwitchCase="'moderator'"
                            class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-700">
                            <i class="pi pi-verified"></i> Modérateur
                        </span>
                    </div>
                </td>
                <td class="p-4">
                    <div class="flex justify-centre gap-2">
                        <button 
                            class="p-2 rounded-full text-blue-600 hover:bg-blue-50 transition-colors"
                            pTooltip="Modifier le rôle"
                            tooltipPosition="bottom">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button 
                            class="p-2 rounded-full text-red-600 hover:bg-red-50 transition-colors"
                            pTooltip="Supprimer l'utilisateur"
                            tooltipPosition="bottom">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        </ng-template>

        <!-- Empty State with Illustration -->
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="4" class="p-8 text-center">
                    <div class="flex flex-col items-center gap-4">
                        <i class="pi pi-search text-6xl text-gray-300"></i>
                        <div>
                            <p class="text-xl font-medium text-gray-600 mb-1">Aucun utilisateur trouvé</p>
                            <p class="text-gray-400">Modifiez vos critères de recherche et réessayez</p>
                        </div>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- Role Change Dialog -->
<p-dialog header="Modifier le rôle" 
          [(visible)]="showRoleDialog" 
          [modal]="true" 
          [style]="{width: '450px'}"
          [draggable]="false">
    <div class="p-4">
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Nouveau rôle pour {{selectedUser?.firstName}} {{selectedUser?.lastName}}
            </label>
            <p-dropdown [options]="['admin', 'moderator', 'psychologue', 'candidate']"
                       [(ngModel)]="selectedRole"
                       class="w-full"></p-dropdown>
        </div>
        <div class="flex justify-end gap-3">
            <button pButton label="Annuler" 
                    class="p-button-text" 
                    (click)="cancelRoleChange()"></button>
            <button pButton label="Confirmer" 
                    class="p-button-primary" 
                    (click)="confirmRoleChange()"></button>
        </div>
    </div>
</p-dialog>

<!-- Delete Confirmation Dialog -->
<p-dialog header="Supprimer l'utilisateur" [(visible)]="displayDialog2" [modal]="true" [style]="{width: '400px'}"
    [baseZIndex]="10000" [draggable]="false" [resizable]="false">
    <div class="p-4 text-center">
        <i class="pi pi-exclamation-triangle text-5xl text-yellow-500 mb-4"></i>
        <h3 class="text-xl font-medium mb-2">Êtes-vous sûr ?</h3>
        <p class="text-gray-600 mb-6">
            Cette action est irréversible et supprimera définitivement l'utilisateur.
        </p>
        <div class="flex justify-center gap-3">
            <button pButton label="Annuler" icon="pi pi-times" class="p-button-text" (click)="cancelDelete()">
            </button>
            <button pButton label="Supprimer" icon="pi pi-trash" class="p-button-danger" (click)="confirmDelete()">
            </button>
        </div>
    </div>
</p-dialog>